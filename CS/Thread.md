### 🔖 22. 5. 7

# 🧵 Thread

> **스레드**(thread)는 어떠한 프로그램 내에서, 특히 프로세스내에서 실행되는 흐름의 단위를 말한다.  
>[위키백과](https://ko.wikipedia.org/wiki/스레드_(컴퓨팅))


**Thread**란 정말 간단히 말하면 *프로그램의 실행 단위*라고 볼 수 있다.  
정확히 말하자면 “프로세스의 실행단위”지만 말이다.

그런데 프로그램은 뭐고, 프로세스는 뭐고, 실행 단위는 대체 무슨 말일까...?

## Program과 Process

먼저 프로그램과 프로세스의 차이를 알아보자.  
우리는 프로그램을 만들기 위해 Swift, C++, Java와 같은 [고급 프로그래밍 언어](https://ko.wikipedia.org/wiki/고급_프로그래밍_언어)를 활용해 코드를 작성한다.  

우리가 작성한 코드가 실행되기 위해서는 크게 2가지 과정이 필요한데,
1. 고급 프로그래밍 언어를 컴파일러나 인터프리터가 저급 언어로 변환해 컴퓨터가 이해할 수 있도록 바꿔준다.
2. OS가 해당 프로그램을 메모리에 올리고, 컴퓨터의 리소스를 할당한다.  

이렇게 프로그램이 실행되면, 우리는 그때부터 프로그램을 **프로세스**라고 부른다.  
**Process**란 실행중인 프로그램을, Program은 실행중이지 않은 코드를 의미하는 것이다.  
즉, Process는 우리가 적은 코드를 OS가 메모리에 올리고, CPU의 리소스를 할당받아 실행되고 있는 프로그램을 말한다.  

아까 Thread는 “어떠한 프로그램 내에서, 특히 프로세스 내에서 실행되는 흐름의 단위”라고 말했다.  
이제 이 문장의 의미가 좀 더 이해가 되는 것 같다.  

이제 Process와 Thread를 비교하면서 좀 더 자세히 알아보자!

## Process와 Thread

프로세스는 OS에 의해 컴퓨터의 리소스를 할당받는다고 했다.  

이때, 프로세스가 할당받는 리소스는 다음과 같다.  
- CPU 시간
- 운영되기 위해 필요한 주소 공간
- Code, Data, Stack, Heap의 구조로 되어 있는 독립된 메모리 영역

따라서 각 프로세스는 독립된 메모리 영역을 가지고 있으며,  
프로세스마다 별도의 주소 공간에서 실행돼 프로세스끼리 접근할 수 없다.   
(다른 프로세스에 접근하려면 [IPC(Inter Process Communication)](https://ko.wikipedia.org/wiki/프로세스_간_통신), 즉 파일나 소켓과 같은 프로세스 간의 통신을 사용해야 한다.)  

**Thread**는 이런 *프로세스가 할당받은 자원을 사용하는 실행 단위*를 의미한다.  

스레드는 프로세스와 달리 Stack만 할당받고 Code, Data, Heap은 다른 스레드들과 공유한다.  
프로세스 내에서 스레드들끼리 주소 공간과 스택을 제외한 메모리를 공유하는 것이다.
그러다보니 프로세스보다 생성, 종료, 전환 시간이 짧다.  

아래 그림처럼 생겼다고 생각하면 쉽다.  

<img width="1245" alt="스크린샷 2022-05-07 오후 10 00 23" src="https://user-images.githubusercontent.com/78457093/167257176-6103b1c6-1d51-4d2a-9e4e-4224cc2d36eb.png">

## Multi Process Vs. Multi Thread

옛날 컴퓨터들은 하나의 프로세스, 하나의 프로그램, 하나의 프로세스당 하나의 스레드만을 지원했다.  
하지만 요즘 컴퓨터는 여러 프로세스, 프로그램을 동시에(정확히 말하면 여러 프로그램을 동시처럼 보일 정도로 아주 빠르게 번갈아 가면서) 작동시킨다.   
하나의 프로그램이 여러 개의 프로세스를 갖기도 하고 하나의 프로세스가 여러 개의 스레드를 갖기도 한다.   

예를 들면, 우리는 유튜브로 음악을 들으면서 게임을 하고 카카오톡을 켜두고 메세지의 알림도 받는다.  
동시에 세 가지 프로세스가 돌아가고 있는 것이다.  
하나의 프로세스만 작동할 수 있다면 게임을 할 때는 음악이 멈추고, 메세지를 받지도 못할 것이다.  

또한 게임을 하는 경우에도 하나의 프로세스 내에서 게임의 그래픽을 그려주는 일, 서버에서 데이터를 받아오는 일 등 여러 가지 일을 하게 된다.  
이 경우 보통 멀티 스레드로 여러 개의 스레드에서 일을 나누어 처리하게 된다.  
그런데 왜 이런 작업들도 여러 개의 프로세스로 하면 되지 굳이 스레드로 하는걸까?  

답은 Context Switching에 있다.  

### Context Switching

CPU는 한 번에 한 가지의 일처리밖에 못 하기 때문에, 두 개의 프로세스를 실행하고 싶다면 두 프로세스가 실행, 준비 상태를 번갈아 가며 CPU에 올라왔다 내려갔다를 반복해야 한다.  

![ContextSwitching](https://user-images.githubusercontent.com/78457093/167257173-3497f543-bb37-4045-b532-8cd9da2e5bcc.gif)

이 때, 프로세스는 각각 별도의 주소 공간을 가지고 있고 독립된 메모리 영역을 가지고 있기 때문에  
Context Switching의 과정에서 프로세스의 상태를 전환하고, 캐시 메모리를 삭제하고 다양한 정보 교환이 이루어지는 등 매우 무겁고 느리다.  

반면 스레드의 경우 메모리를 공유하고 있어 Stack 영역만 처리하면 되기 때문에 훨씬 가볍고 빠르다.  

따라서 서로 다른 프로그램(유튜브, 게임, 카카오톡 등)을 작동시키는 것은 서로 독립적이고 안정적으로 운영하기 위해 멀티 프로세스를 활용하지만,  
한 프로세스 내에서의 작업들은 멀티 스레드를 활용하는 것이 더욱 효율적일 것이다.

> 참고
[https://exponential-e.tistory.com/55](https://exponential-e.tistory.com/55)  
[https://charlezz.medium.com/process와-thread-이야기-5b96d0d43e37](https://charlezz.medium.com/process%EC%99%80-thread-%EC%9D%B4%EC%95%BC%EA%B8%B0-5b96d0d43e37)  
[https://gmlwjd9405.github.io/2018/09/14/process-vs-thread.html](https://gmlwjd9405.github.io/2018/09/14/process-vs-thread.html)  
[https://www.youtube.com/watch?v=1grtWKqTn50&t=655s](https://www.youtube.com/watch?v=1grtWKqTn50&t=655s)  
>
